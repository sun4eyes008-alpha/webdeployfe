<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PLTT OUTBOUND</title>
    <link rel="stylesheet" href="style2.css" />
  </head>
  <body>
    <!-- Header -->
    <header id="main-header">
      <div class="header-container">
        <button class="sidebar-toggle" id="sidebar-toggle">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="logo-container">
          <a href="index.html">
            <img
              src="./logo/logo-fecredit.svg"
              alt="FECredit"
              class="logo"
            />
          </a>
        </div>

        <!-- NEW SEARCH BAR -->
        <div class="search-container">
          <input
            type="search"
            id="header-search"
            placeholder="T√¨m ki·∫øm th√¥ng tin..."
          />
          <div id="search-results-container" class="search-results"></div>
        </div>

        <div class="header-tabs">
          <div class="dropdown">
            <button class="tab-btn dropdown-toggle">PLTT</button>
            <div class="dropdown-menu">
              <a href="loan.html" class="dropdown-item" id="loan-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                  <path
                    d="M1.5 3a.5.5 0 0 1 .5-.5h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-12a.5.5 0 0 1-.5-.5v-2z"
                  />
                  <path
                    d="M1 6.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-1z"
                  />
                  <path
                    d="M1 9.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-1zm13.5 2.5a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0 0 1h13a.5.5 0 0 0 .5-.5z"
                  />
                </svg>
                LOAN
              </a>
              <a href="card.html" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                  <path
                    d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1H2zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V7z"
                  />
                  <path
                    d="M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1v-1z"
                  />
                </svg>
                CARD
              </a>
              <a href="outbound.html" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                  <path
                    fill-rule="evenodd"
                    d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511zM11 .5a.5.5 0 0 1 .5.5V3h2.5a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0V4h-2.5a.5.5 0 0 1 0-1H10V.5a.5.5 0 0 1 .5-.5z"
                  />
                </svg>
                OUTBOUND
              </a>
              <a href="ubank.html" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                  <path
                    d="M8 .95 1.75 4h12.5L8 .95zM1 5.5v1h14v-1H1zm.25 2.5a.5.5 0 0 0 0 1h13.5a.5.5 0 0 0 0-1H1.25zM1 10.5v1h14v-1H1zM1.75 13h12.5l-6.25 3.05L1.75 13zM1 14.25v-1h14v1H1z"
                  />
                </svg>

                UBANK
              </a>
            </div>
          </div>
          <button class="tab-btn" data-tab="xmtt">XMTT</button>
          <button class="tab-btn" data-tab="quy-dinh">QUY ƒê·ªäNH CHUNG</button>
          <button class="tab-btn" data-tab="khuyen-mai" id="khuyen-mai-btn">
            KHUY·∫æN M√ÉI
          </button>
          <button class="tab-btn" data-tab="change-log" id="change-log-btn">
            CHANGE LOG
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <nav id="sidebar">
      <div class="sidebar-header">
        <h5>ƒêI·ªÄU KI·ªÜN</h5>
      </div>
      <div class="sidebar-content">
        <div id="dynamic-filters-container"></div>
      </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
      <!-- Sub Header -->
      <div id="sub-header">
        <div class="sub-header-box" id="xmtt-box">
          <button class="expand-btn" data-target="xmtt-box">‚§¢</button>
          <div id="xmtt-result" class="box-content">
            <div class="xmtt-column" id="xmtt-ib-column">
              <h5>XMTT IB</h5>
              <div id="xmtt-ib-content"><p>...</p></div>
            </div>
            <div class="xmtt-column" id="xmtt-ecom-column">
              <h5>XMTT ECOM</h5>
              <div id="xmtt-ecom-content"><p>...</p></div>
            </div>
          </div>
        </div>
        <div class="sub-header-box" id="notes-box">
          <button class="expand-btn" data-target="notes-box">‚§¢</button>
          <div id="notes-result" class="box-content">
            <p>Th√¥ng b√°o v√† l∆∞u √Ω s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
          </div>
        </div>
      </div>

      <!-- Body Content (PDF Viewer) -->
      <div id="body-proper">
        <iframe
          id="pdf-viewer"
          src=""
          style="width: 100%; height: 100%; border: none"
        ></iframe>
      </div>
    </main>

    <div id="custom-popup" class="popup-container hidden">
      <button id="popup-close-btn">‚úñ</button>
      <div id="popup-content"></div>
    </div>

    <div id="overlay"></div>
    <div id="toast-container"></div>
    <script>
// Embedded flowchart data
/**
 * H∆Ø·ªöNG D·∫™N C·∫¨P NH·∫¨T D·ªÆ LI·ªÜU FLOWCHART
 *
 * 1. C·∫§U TR√öC:
 *    - D·ªØ li·ªáu ƒë∆∞·ª£c t·ªï ch·ª©c d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng (Object) l·ªìng nhau.
 *    - "Value" (gi√° tr·ªã) c√≥ th·ªÉ l√† m·ªôt ƒë·ªëi t∆∞·ª£ng con (nh√°nh) ho·∫∑c m·ªôt ƒë·ªëi t∆∞·ª£ng ch·ª©a th√¥ng tin ƒëi·ªÅu ki·ªán cu·ªëi (l√°).
 *    - ƒêi·ªÅu ki·ªán cu·ªëi (l√°) ph·∫£i ch·ª©a c√°c thu·ªôc t√≠nh: `pdf`, `note`, `xmtt`.
 *
 * 2. KHAI B√ÅO XMTT:
 *    - C√°c n·ªôi dung XMTT d√πng chung ƒë∆∞·ª£c khai b√°o b·∫±ng bi·∫øn h·∫±ng (const) ·ªü ƒë·∫ßu file.
 *    - Khi c·∫ßn s·ª≠a n·ªôi dung m·ªôt XMTT, ch·ªâ c·∫ßn s·ª≠a ·ªü d√≤ng khai b√°o t∆∞∆°ng ·ª©ng.
 */

// --- KHAI B√ÅO C√ÅC LO·∫†I XMTT D√ôNG CHUNG ---
const XMTT_1 = "1. Kh√¥ng c·∫ßn XMTT";
const XMTT_2 = "2. CMND/CCCD";
const XMTT_3 = "3. CCCD/CMND/SHD";
const XMTT_4 = "4. ƒê√∫ng SƒêT + CMND/CCCD + 1A";
const XMTT_5 = "5. ƒê√∫ng SƒêT + CMND + Sai 1A";
const XMTT_6 = "6. ƒê√∫ng SƒêT + CMND + 1A + 1B";
const XMTT_7 = "7. ƒê√∫ng SƒêT update + CMND + 2A + 1B";
const XMTT_8 =
  "8. Sai SƒêT<br>  a. c√≤n d√πng SDT c≈©: d√πng ƒë√∫ng SDT g·ªçi l·∫°i<br>  b. Kh√¥ng c√≤n d√πng SDT:<br>   - Hƒê Closed h·∫øt: CMND/CCCD + 1A<br>   - Hƒê c√≤n m·ªü: CMND/CCCD + 2A  ƒë·ªìng th·ªùi h∆∞·ªõng d·∫´n c·∫≠p nh·∫≠t SDT.";
const XMTT_9 = "9. Sai SƒêT + CMND + 1A";

const flowchartData = {
  "1. TH√îNG TIN CHUNG": {
    "Th√¥ng tin c√¥ng ty": {
      displayName: "Th√¥ng tin c√¥ng ty",
      pdf: "Th√¥ng tin c√¥ng ty.pdf",
      note: "C√°c th√¥ng tin c∆° b·∫£n v·ªÅ c√¥ng ty.",
    },
    "H·ª£p t√°c kinh doanh": {
      displayName: "H·ª£p t√°c kinh doanh",
      pdf: "H·ª£p t√°c kinh doanh.pdf",
      note: "Th√¥ng tin d√†nh cho ƒë·ªëi t√°c mu·ªën h·ª£p t√°c kinh doanh.",
    },
    "X√≥a D·ªØ Li·ªáu C√° Nh√¢n": {
      displayName: "X√≥a D·ªØ Li·ªáu C√° Nh√¢n",
      pdf: "X√≥a D·ªØ Li·ªáu C√° Nh√¢n.pdf",
      note: "H∆∞·ªõng d·∫´n th·ª±c hi·ªán y√™u c·∫ßu x√≥a d·ªØ li·ªáu c√° nh√¢n theo quy ƒë·ªãnh.",
    },
    "M·ªü Ch·∫∑n Cu·ªôc G·ªçi": {
      displayName: "M·ªü Ch·∫∑n Cu·ªôc G·ªçi",
      pdf: "M·ªü Ch·∫∑n Cu·ªôc G·ªçi.pdf",
      note: "N/A",
    },
    "Ng·ª´ng M·ªùi Vay/QC": {
      displayName: "Ng·ª´ng M·ªùi Vay/QC",
      pdf: "Ng·ª´ng M·ªùi Vay_QC.pdf",
      note: "N/A",
    },
    "Khuy·∫øn M√£i": {
      displayName: "Khuy·∫øn M√£i",
      pdf: "Khuy·∫øn M√£i.pdf",
      note: "N/A",
    },
  },
  "2. TH√îNG TIN S·∫¢N PH·∫®M": {
    "Vay Mua Xe M√°y": {
      displayName: "Th√¥ng tin s·∫£n ph·∫©m > Vay Mua Xe M√°y",
      pdf: "S·∫£n Ph·∫©m Vay Mua Xe M√°y.pdf",
      note: "N/A",
    },
    "Vay Mua ƒêi·ªán M√°y": {
      displayName: "Th√¥ng tin s·∫£n ph·∫©m > Vay Mua ƒêi·ªán M√°y",
      pdf: "S·∫£n Ph·∫©m Vay Mua ƒêi·ªán M√°y.pdf",
      note: "N/A",
    },
    "Vay Ti·ªÅn M·∫∑t": {
      displayName: "Th√¥ng tin s·∫£n ph·∫©m > Vay Ti·ªÅn M·∫∑t",
      pdf: "S·∫£n Ph·∫©m Vay Ti·ªÅn M·∫∑t.pdf",
      note: "N/A",
    },
  },
  "3. ƒêƒÇNG K√ù VAY": {
    "Vay Mua Xe M√°y": {
      displayName: "ƒêƒÉng k√Ω vay > Vay Mua Xe M√°y",
      pdf: "Vay S·∫£n Ph·∫©m Vay Mua Xe M√°y.pdf",
      note: "N/A",
    },
    "Vay Mua ƒêi·ªán M√°y": {
      displayName: "ƒêƒÉng k√Ω vay > Vay Mua ƒêi·ªán M√°y",
      pdf: "Vay S·∫£n Ph·∫©m Vay Mua ƒêi·ªán M√°y.pdf",
      note: "N/A",
    },
    "Vay Ti·ªÅn M·∫∑t": {
      pdf: "Vay S·∫£n Ph·∫©m Vay Ti·ªÅn M·∫∑t.pdf",
      note: "N/A",
      displayName: "ƒêƒÉng k√Ω vay PL",
    },
  },
  "4. GI·∫¢I NG√ÇN": {
    "Gi·∫£i Ng√¢n Ti·ªÅn M·∫∑t": {
      displayName: "Gi·∫£i Ng√¢n Ti·ªÅn M·∫∑t",
      pdf: "Gi·∫£i Ng√¢n Ti·ªÅn M·∫∑t.pdf",
      note: "N/A",
    },
  },
  "5. K√äNH THANH TO√ÅN": {
    "TT TR·ª∞C TUY·∫æN": {
      displayName: "K√™nh thanh to√°n > TT TR·ª∞C TUY·∫æN",
      pdf: "THANH TO√ÅN TR·ª∞C TUY·∫æN.pdf",
      note: `Thanh to√°n chuy·ªÉn kho·∫£n qua VPbank ƒë∆∞·ª£c ho√†n 5.000vnd v√†o th√°ng ti·∫øp theo.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.
                    </br> L∆∞u √Ω: Chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë h·ª£p ƒë·ªìng v√† t√™n ng∆∞·ªùi vay.`,
      alert:
        "Thanh to√°n chuy·ªÉn kho·∫£n qua VPbank ƒë∆∞·ª£c ho√†n 5.000vnd v√†o th√°ng ti·∫øp theo",
    },
    "TT TI·ªÄN M·∫∂T": {
      displayName: "K√™nh thanh to√°n > TT TI·ªÄN M·∫∂T",
      pdf: "THANH TO√ÅN TI·ªÄN M·∫∂T.pdf",
      note: "N/A",
    },
    "TT QUA ATM/CDM": {
      displayName: "K√™nh thanh to√°n > TT QUA ATM/CDM",
      pdf: "THANH TO√ÅN QUA ATM CDM.pdf",
      note: "N/A",
    },
    "TR√çCH N·ª¢ T·ª∞ ƒê·ªòNG": {
      displayName: "K√™nh thanh to√°n > TR√çCH N·ª¢ T·ª∞ ƒê·ªòNG",
      pdf: "TR√çCH N·ª¢ T·ª∞ ƒê·ªòNG.pdf",
      note: "N/A",
    },
  },
  "6. THANH TO√ÅN + CIC": {
    "L·ªãch Tr·∫£ N·ª£": {
      "Hƒê FEC": { displayName: "L·ªãch Tr·∫£ N·ª£ Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_4 },
      "Cash 24": { displayName: "L·ªãch Tr·∫£ N·ª£ Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "L·ªãch Tr·∫£ N·ª£ Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "L·ªãch Tr·∫£ N·ª£ B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "L·ªãch Tr·∫£ N·ª£ B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "L·ªãch Tr·∫£ N·ª£ B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "L·ªãch Tr·∫£ N·ª£ B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
    "L·ªãch S·ª≠ TT": {
      "Hƒê FEC": { displayName: "L·ªãch S·ª≠ TT Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_4 },
      "Cash 24": { displayName: "L·ªãch S·ª≠ TT Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "L·ªãch S·ª≠ TT Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "L·ªãch S·ª≠ TT B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "L·ªãch S·ª≠ TT B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "L·ªãch S·ª≠ TT B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "L·ªãch S·ª≠ TT B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
    "Thanh L√Ω Hƒê": {
      "Hƒê FEC": { displayName: "Thanh L√Ω Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_4 },
      "Cash 24": { displayName: "Thanh L√Ω Hƒê Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "Thanh L√Ω Hƒê Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "Thanh L√Ω Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "Thanh L√Ω Hƒê B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "Thanh L√Ω Hƒê B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "Thanh L√Ω Hƒê B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
    "Th·ªèa Thu·∫≠n KV": {
      "Hƒê FEC": { displayName: "Th·ªèa Thu·∫≠n KV Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_8 },
      "Cash 24": { displayName: "Th·ªèa Thu·∫≠n KV Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "Th·ªèa Thu·∫≠n KV Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "Th·ªèa Thu·∫≠n KV B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "Th·ªèa Thu·∫≠n KV B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "Th·ªèa Thu·∫≠n KV B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "Th·ªèa Thu·∫≠n KV B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
    "T√¨nh Tr·∫°ng Hƒê": {
      "Hƒê FEC": { displayName: "T√¨nh Tr·∫°ng Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_8 },
      "Cash 24": { displayName: "T√¨nh Tr·∫°ng Hƒê Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "T√¨nh Tr·∫°ng Hƒê Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "T√¨nh Tr·∫°ng Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "T√¨nh Tr·∫°ng Hƒê B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "T√¨nh Tr·∫°ng Hƒê B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "T√¨nh Tr·∫°ng Hƒê B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
    "ƒê√≥ng Hƒê": {
      "Hƒê FEC": { displayName: "ƒê√≥ng Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_4 },
      "Cash 24": { displayName: "ƒê√≥ng Hƒê Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "ƒê√≥ng Hƒê Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "ƒê√≥ng Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "ƒê√≥ng Hƒê B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "ƒê√≥ng Hƒê B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "ƒê√≥ng Hƒê B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
    CIC: {
      "Hƒê FEC": { displayName: "CIC Hƒê FEC", pdf: "IB Dung SDT.pdf", note: "N/A", xmtt: XMTT_4 },
      "Cash 24": { displayName: "CIC Cash 24", pdf: "HD Cash 24.pdf", note: "N/A", xmtt: XMTT_1 },
      "Kim An": {
        displayName: "CIC Kim An",
        pdf: "Hƒê Kim An.pdf",
        note: "L∆∞u √Ω cho h·ª£p ƒë·ªìng Kim An.",
      },
      "B√°n N·ª£ M·ªôt Ph·∫ßn": {
        displayName: "CIC B√°n N·ª£ M·ªôt Ph·∫ßn",
        pdf: "Hƒê B√°n N·ª£ M·ªôt Ph·∫ßn.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Galaxy": {
        displayName: "CIC B√°n N·ª£ Galaxy",
        pdf: "Hƒê B√°n N·ª£ Galaxy.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Fc Sold_Azura": {
        displayName: "CIC B√°n N·ª£ Fc Sold_Azura",
        pdf: "Hƒê B√°n N·ª£ Fc Sold_Azura.pdf",
        note: "N/A",
      },
      "B√°n N·ª£ Welcome Vina": {
        displayName: "CIC B√°n N·ª£ Welcome Vina",
        pdf: "Hƒê B√°n N·ª£ Welcome Vina.pdf",
        note: "N/A",
      },
    },
  },
  "7. Test": {
    "7.1. M·ª•c con Test": {
        displayName: "Test > M·ª•c con Test",
        pdf: "Test.pdf",
        note: "ƒê√¢y l√† ghi ch√∫ cho m·ª•c test.",
        xmttib: "N·ªôi dung cho IB ·ªü m·ª•c Test.",
        xmttecom: "N·ªôi dung cho ECOM ·ªü m·ª•c Test."
    }
  },
};

</script>
<script>
// Embedded main script
document.addEventListener("DOMContentLoaded", () => {
  // Check if data is loaded
  if (typeof flowchartData === "undefined") {
    console.error(
      "Flowchart data not loaded. Make sure flowchart-data.js is included and correct."
    );
    return;
  }

  // --- DOM ELEMENT REFERENCES ---
  const dynamicFiltersContainer = document.getElementById(
    "dynamic-filters-container"
  );
  const xmttResult = document.getElementById("xmtt-result");
  const notesResult = document.getElementById("notes-result");
  const pdfViewer = document.getElementById("pdf-viewer");
  const sidebarToggle = document.getElementById("sidebar-toggle");
  const mainHeader = document.getElementById("main-header");
  const body = document.body;
  const toastContainer = document.getElementById("toast-container");
  const overlay = document.getElementById("overlay");
  const headerSearch = document.getElementById("header-search");
  const searchResultsContainer = document.getElementById(
    "search-results-container"
  );
  const subHeader = document.getElementById("sub-header");

  // --- CONSTANTS AND STATE VARIABLES ---
  const FOLDER_MAP = {
    1: "THONG_TIN_CHUNG",
    2: "THONG_TIN_SAN_PHAM",
    3: "DANG_KY_VAY",
    4: "GIAI_NGAN",
    5: "KENH_THANH_TOAN",
    6: "THANH_TOAN_CIC",
    7: "TEST",
  };
  const levelLabels = {
    1: "Ch·ªçn v·∫•n ƒë·ªÅ:",
    2: "Ch·ªçn chi ti·∫øt v·∫•n ƒë·ªÅ:",
    3: "Ch·ªçn lo·∫°i Hƒê:",
    4: "Ch·ªçn k√™nh:",
    5: "Ch·ªçn lo·∫°i ƒë·∫ßu v√†o:",
  };
  let flattenedFlowchartData = []; // For efficient searching

  // --- UTILITY FUNCTIONS ---
  function isObject(value) {
    return typeof value === "object" && value !== null;
  }

  function isLeaf(node) {
    return isObject(node) && node.pdf !== undefined;
  }

  function removeAccents(str) {
    if (!str) return "";
    return str
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/ƒë/g, "d")
      .replace(/ƒê/g, "D");
  }

  function flattenFlowchart(node, path = [], breadcrumb = []) {
    Object.keys(node).forEach((key) => {
      const newPath = [...path, key];
      const newBreadcrumb = [...breadcrumb, key.replace(/^\d+\.\s*/, "")];
      const childNode = node[key];

      if (isLeaf(childNode)) {
        const displayText = childNode.displayName || newBreadcrumb.join(" > ");
        const pdfName = childNode.pdf || "";

        flattenedFlowchartData.push({
          path: newPath,
          pdfName: pdfName,
          displayText: displayText,
          // Add pre-normalized versions for efficient searching
          normalizedDisplayText: removeAccents(displayText.toLowerCase()),
          normalizedPdfName: removeAccents(pdfName.toLowerCase()),
        });
      } else if (isObject(childNode)) {
        flattenFlowchart(childNode, newPath, newBreadcrumb);
      }
    });
  }

  // --- INITIALIZATION ---
  function initialize() {
    flattenFlowchart(flowchartData);
    createFirstLevelDropdown();
    setupEventListeners();
    // New: Check URL for state on load
    restoreStateFromURL();
  }

  // --- STATE MANAGEMENT (URL) ---
      function saveStateToURL(path) {
        // Encode path for URL: JSON -> URIComponent -> base64
        const jsonPath = JSON.stringify(path);
        const encodedPath = btoa(encodeURIComponent(jsonPath));

        // Use hash for state, remove query parameter to avoid conflicts
        const newUrl = window.location.pathname + "#" + encodedPath;
        history.pushState({ path: path }, "", newUrl);
        console.log('üíæ Saved state to URL hash:', newUrl);
      }

      function restoreStateFromURL() {
        console.log('üîç Checking URL for state...');
        const hash = window.location.hash;

        // 1. Try restoring from hash (new primary method)
        if (hash && hash.length > 1) {
          const encodedPath = hash.substring(1);
          console.log('üìã Found hash:', encodedPath);
          try {
            const jsonPath = decodeURIComponent(atob(encodedPath));
            const path = JSON.parse(jsonPath);
            if (Array.isArray(path)) {
              console.log('üéØ Applying state from hash:', path);
              applySearchResult(path, false);
              return; // State restored
            }
          } catch (e) {
            console.error("‚ùå Failed to parse state from hash. It might be a legacy hash.", e);
             // Fallback for old, non-base64 hash format
            try {
              const decodedParam = decodeURIComponent(encodedPath);
              const path = JSON.parse(decodedParam);
              if (Array.isArray(path)) {
                console.log('üéØ Applying from hash (legacy):', path);
                applySearchResult(path, false);
                return; // Success
              }
            } catch (e2) {
              console.error("‚ùå Invalid path data in hash.", e2);
            }
          }
          return; // Stop after attempting hash
        }

        // 2. Fallback for old links: Try restoring from query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const pathParam = urlParams.get('path');
        if (pathParam) {
          console.log('üìã Found legacy query parameter:', pathParam);
          try {
            const jsonPath = decodeURIComponent(atob(pathParam));
            const path = JSON.parse(jsonPath);
            if (Array.isArray(path)) {
              console.log('üéØ Applying state from query parameter, will update URL to hash format.');
              // Restore state but don't re-save/push history here
              applySearchResult(path, false);

              // Replace the URL to use the new hash format without adding a new history entry
              const newUrl = window.location.pathname + "#" + pathParam;
              history.replaceState({ path: path }, "", newUrl);
              return; // State restored and URL updated
            }
          } catch (e) {
            console.error("‚ùå Failed to parse state from query parameter.", e);
          }
          return;
        }

        console.log('‚ÑπÔ∏è No state found in URL.');
      }

  // --- SEARCH FUNCTIONALITY ---
  function searchFlowchartData(query) {
    if (!query) return [];
    // Normalize the user's query once
    const normalizedQuery = removeAccents(query.toLowerCase());

    return flattenedFlowchartData.filter((item) => {
      // Search against the pre-normalized data
      const matchesDisplayText =
        item.normalizedDisplayText.includes(normalizedQuery);
      const matchesPdf = item.normalizedPdfName.includes(normalizedQuery);
      return matchesDisplayText || matchesPdf;
    });
  }

  function displaySearchResults(results) {
    searchResultsContainer.innerHTML = "";
    if (results.length === 0) {
      searchResultsContainer.classList.remove("show");
      return;
    }

    results.slice(0, 10).forEach((result) => {
      const resultItem = document.createElement("div");
      resultItem.className = "search-result-item";
      resultItem.textContent = result.displayText;
      resultItem.dataset.path = JSON.stringify(result.path);
      searchResultsContainer.appendChild(resultItem);
    });
    searchResultsContainer.classList.add("show");
  }

  // Modified to prevent re-saving state when restoring
  function applySearchResult(path, shouldSaveState = true) {
    removeDropdowns(1);
    let currentDataNode = flowchartData;
    let lastKey = "";
    let finalNode = null;
    let finalPath = [];

    path.forEach((key, index) => {
      const level = index + 1;
      const options = Object.keys(currentDataNode);
      createDropdown(options, level, currentDataNode);
      const select = dynamicFiltersContainer.querySelector(
        `select[data-level="${level}"]`
      );
      if (select) {
        select.value = key;
        lastKey = key;
        finalPath.push(key);
        currentDataNode = currentDataNode[key];
      }
    });

    finalNode = currentDataNode;

    if (isLeaf(finalNode)) {
      displayResult(finalNode, lastKey);
      if (shouldSaveState) {
        saveStateToURL(finalPath);
      }
    }

    searchResultsContainer.classList.remove("show");
    headerSearch.value = "";
    headerSearch.blur();
  }

  // --- DROPDOWN AND SELECTION LOGIC ---
  function createFirstLevelDropdown() {
    dynamicFiltersContainer.innerHTML = "";
    createDropdown(Object.keys(flowchartData), 1, flowchartData);
  }

  function createDropdown(options, level, dataNode) {
    const filterGroup = document.createElement("div");
    filterGroup.className = "filter-group";

    const label = document.createElement("label");
    label.className = "filter-label";
    label.textContent = levelLabels[level] || `C·∫•p ${level}:`;
    filterGroup.appendChild(label);

    const select = document.createElement("select");
    select.className = "filter-select";
    select.dataset.level = level;
    select.innerHTML = '<option value="">-- Ch·ªçn --</option>';
    options.forEach((text) => {
      const option = document.createElement("option");
      option.value = text;
      option.textContent = text;
      select.appendChild(option);
    });
    select.addEventListener("change", (e) =>
      handleSelection(e, level, dataNode)
    );
    filterGroup.appendChild(select);
    dynamicFiltersContainer.appendChild(filterGroup);
  }

  // Modified to save state to URL
  function handleSelection(event, level, parentDataNode) {
    const selectedKey = event.target.value;
    removeDropdowns(level + 1);
    resetResults();

    if (!selectedKey) {
      history.pushState(null, "", window.location.pathname); // Clear URL params if selection is cleared
      return;
    }

    const selectedNode = parentDataNode[selectedKey];
    if (isLeaf(selectedNode)) {
      displayResult(selectedNode, selectedKey);
      // Construct the path and save it
      const path = [];
      document.querySelectorAll(".filter-select").forEach((select) => {
        if (select.value) {
          path.push(select.value);
        }
      });
      saveStateToURL(path);
    } else if (isObject(selectedNode)) {
      createDropdown(Object.keys(selectedNode), level + 1, selectedNode);
    }
  }

  // --- UI AND EVENT LISTENERS SETUP ---
  const popup = document.getElementById("custom-popup");
  const popupContent = document.getElementById("popup-content");
  const popupCloseBtn = document.getElementById("popup-close-btn");
  const sidebar = document.getElementById("sidebar"); // Get sidebar reference

  function repositionPopup() {
    if (popup.classList.contains("hidden")) {
      return; // Do nothing if the popup is not visible
    }

    const subHeaderRect = subHeader.getBoundingClientRect(); // Still used for height calculation
    const mainHeaderHeight = mainHeader.offsetHeight;
    const sidebarWidth = sidebar.offsetWidth;

    const leftOffset = 5; // 5px from the left (relative to sidebar edge)
    const rightOffset = 20; // 20px from the right edge of the viewport
    const totalHorizontalMargin = leftOffset + rightOffset;

    popup.style.top = mainHeaderHeight + "px";
    popup.style.left = sidebarWidth + leftOffset + "px";
    popup.style.width = `calc(100vw - ${sidebarWidth}px - ${totalHorizontalMargin}px)`;
    popup.style.height = subHeaderRect.height + "px";
  }

  function openPopup(targetBoxId) {
    const sourceBox = document.getElementById(targetBoxId);
    const sourceContent = sourceBox.querySelector(".box-content");

    if (!sourceBox || !sourceContent) {
      console.error("Popup source elements not found!");
      return;
    }

    // 1. Populate content first
    popupContent.innerHTML = "";
    const clonedContent = sourceContent.cloneNode(true);
    popupContent.appendChild(clonedContent);

    // 2. Position and show
    popup.classList.remove("hidden");
    repositionPopup(); // Set initial position
  }

  function closePopup() {
    popup.classList.add("hidden");
    setTimeout(() => {
      popupContent.innerHTML = "";
    }, 300);
  }

  function setupEventListeners() {
    sidebarToggle.addEventListener("click", () => {
      body.classList.toggle("sidebar-collapsed");
      // Recalculate popup position after the sidebar transition finishes
      setTimeout(repositionPopup, 300); // 300ms matches CSS --transition-speed
    });

    headerSearch.addEventListener("input", (e) => {
      const results = searchFlowchartData(e.target.value);
      displaySearchResults(results);
    });

    headerSearch.addEventListener("focus", (e) => {
      const results = searchFlowchartData(e.target.value);
      if (results.length > 0) searchResultsContainer.classList.add("show");
    });

    searchResultsContainer.addEventListener("mousedown", (e) => {
      const item = e.target.closest(".search-result-item");
      if (item?.dataset.path) {
        applySearchResult(JSON.parse(item.dataset.path));
      }
    });

    document.addEventListener("click", (e) => {
      if (
        !headerSearch.contains(e.target) &&
        !searchResultsContainer.contains(e.target)
      ) {
        searchResultsContainer.classList.remove("show");
      }
    });

    // Listen for popstate events (browser back/forward navigation)
    window.addEventListener("popstate", () => {
      console.log('üîÑ Popstate event, restoring state...');
      restoreStateFromURL();
    });

    const changeLogBtn = document.getElementById("change-log-btn");
    if (changeLogBtn) {
      changeLogBtn.addEventListener("click", () => {
        pdfViewer.src = "./pdfile-outbound/DANG_KY_VAY/Vay S·∫£n Ph·∫©m Vay Ti·ªÅn M·∫∑t.pdf";
        document.getElementById("xmtt-ib-content").innerHTML = "<p>...</p>";
        document.getElementById("xmtt-ecom-content").innerHTML = "<p>...</p>";
        notesResult.innerHTML = "<p>Th√¥ng b√°o v√† l∆∞u √Ω s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>";
      });
    }

    const khuyenMaiBtn = document.getElementById("khuyen-mai-btn");
    if (khuyenMaiBtn) {
      khuyenMaiBtn.addEventListener("click", () => {
        pdfViewer.src = "./pdfile-outbound/DANG_KY_VAY/Vay S·∫£n Ph·∫©m Vay Ti·ªÅn M·∫∑t.pdf";
        document.getElementById("xmtt-ib-content").innerHTML = "<p>...</p>";
        document.getElementById("xmtt-ecom-content").innerHTML = "<p>...</p>";
        notesResult.innerHTML = "<p>Th√¥ng b√°o v√† l∆∞u √Ω s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>";
      });
    }

    // Popup logic
    document.querySelectorAll(".expand-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        openPopup(btn.dataset.target);
      });
    });

    popupCloseBtn.addEventListener("click", closePopup);

    // Add a single, persistent resize listener
    window.addEventListener("resize", repositionPopup);
  }

  // --- UI DISPLAY LOGIC ---
  function displayResult(resultObject, selectionText) {
    // New logic for IB/ECOM
    const xmttIbContent = document.getElementById("xmtt-ib-content");
    const xmttEcomContent = document.getElementById("xmtt-ecom-content");

    xmttIbContent.innerHTML = resultObject.xmttib
      ? `<p>${resultObject.xmttib}</p>`
      : "<p>...</p>";
    xmttEcomContent.innerHTML = resultObject.xmttecom
      ? `<p>${resultObject.xmttecom}</p>`
      : "<p>...</p>";

    // Handle old 'xmtt' property for backward compatibility
    if (resultObject.xmtt) {
      xmttIbContent.innerHTML = `<p>${resultObject.xmtt}</p>`;
      xmttEcomContent.innerHTML = `<p>${resultObject.xmtt}</p>`;
    }

    notesResult.innerHTML = resultObject.note
      ? `<p>${resultObject.note}</p>`
      : "<p>Kh√¥ng c√≥ l∆∞u √Ω.</p>";

    if (resultObject.pdf) {
      const firstLevelSelect = dynamicFiltersContainer.querySelector(
        'select[data-level="1"]'
      );
      const categoryIndexMatch = firstLevelSelect?.value.match(/^(\d+)/);
      const folderName = categoryIndexMatch
        ? FOLDER_MAP[categoryIndexMatch[1]]
        : null;
      pdfViewer.src = folderName
        ? `./pdfile-outbound/${folderName}/${resultObject.pdf}`
        : `./pdfile-outbound/${resultObject.pdf}`;
    } else {
      pdfViewer.src = "";
    }

    if (resultObject.alert) {
      (Array.isArray(resultObject.alert)
        ? resultObject.alert
        : [resultObject.alert]
      ).forEach((msg) => showNotification(msg));
    }
  }

  function showNotification(message) {
    if (!toastContainer) return;
    const toast = document.createElement("div");
    toast.className = "notification-toast show";
    toast.innerHTML = `<p>${message}</p><button class="toast-close">‚úï</button>`;
    toast.querySelector(".toast-close").onclick = () => {
      toast.classList.remove("show");
      setTimeout(() => toast.remove(), 400);
    };
    toastContainer.appendChild(toast);
  }

  function resetResults() {
    const xmttIbContent = document.getElementById("xmtt-ib-content");
    const xmttEcomContent = document.getElementById("xmtt-ecom-content");
    // Clear all content areas
    xmttIbContent.innerHTML = "<p>...</p>";
    xmttEcomContent.innerHTML = "<p>...</p>";
    notesResult.innerHTML = "<p>Th√¥ng b√°o v√† l∆∞u √Ω s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>";
    pdfViewer.src = "";
  }

  function removeDropdowns(startLevel) {
    dynamicFiltersContainer
      .querySelectorAll(".filter-group")
      .forEach((group) => {
        const select = group.querySelector("select");
        if (parseInt(select.dataset.level) >= startLevel) group.remove();
      });
  }

  // --- START THE APP ---
  initialize();
});

</script>
  </body>
</html>
